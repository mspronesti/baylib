\hypertarget{rejection__sampling_8hpp_source}{}\doxysection{rejection\+\_\+sampling.\+hpp}
\label{rejection__sampling_8hpp_source}\index{/home/mspronesti/Desktop/baylib/baylib/inference/rejection\_sampling.hpp@{/home/mspronesti/Desktop/baylib/baylib/inference/rejection\_sampling.hpp}}
\mbox{\hyperlink{rejection__sampling_8hpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{//}}
\DoxyCodeLine{2 \textcolor{comment}{// Created by elle on 07/09/21.}}
\DoxyCodeLine{3 \textcolor{comment}{//}}
\DoxyCodeLine{4 }
\DoxyCodeLine{5 \textcolor{preprocessor}{\#ifndef BAYLIB\_REJECTION\_SAMPLING\_HPP}}
\DoxyCodeLine{6 \textcolor{preprocessor}{\#define BAYLIB\_REJECTION\_SAMPLING\_HPP}}
\DoxyCodeLine{7 }
\DoxyCodeLine{8 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{abstract__inference__algorithm_8hpp}{baylib/inference/abstract\_inference\_algorithm.hpp}}>}}
\DoxyCodeLine{9 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{random__generator_8hpp}{baylib/tools/random/random\_generator.hpp}}>}}
\DoxyCodeLine{10 }
\DoxyCodeLine{13 }
\DoxyCodeLine{14 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespacebn}{bn}}\{}
\DoxyCodeLine{15     \textcolor{keyword}{namespace }inference \{}
\DoxyCodeLine{31         \textcolor{keyword}{template} <}
\DoxyCodeLine{32                 BNetDerived Network\_,}
\DoxyCodeLine{33                 \textcolor{keyword}{typename} Generator\_ = std::mt19937}
\DoxyCodeLine{34                 >}
\DoxyCodeLine{35         \textcolor{keyword}{class }\mbox{\hyperlink{classbn_1_1inference_1_1rejection__sampling}{rejection\_sampling}} : \textcolor{keyword}{public} \mbox{\hyperlink{classbn_1_1inference_1_1parallel__inference__algorithm}{parallel\_inference\_algorithm}}<Network\_>}
\DoxyCodeLine{36         \{}
\DoxyCodeLine{37             \textcolor{keyword}{using} \textcolor{keyword}{typename} parallel\_inference\_algorithm<Network\_>::network\_type;}
\DoxyCodeLine{38             \textcolor{keyword}{using} \textcolor{keyword}{typename} parallel\_inference\_algorithm<Network\_>::probability\_type;}
\DoxyCodeLine{39             \textcolor{keyword}{using} \mbox{\hyperlink{classbn_1_1inference_1_1parallel__inference__algorithm}{parallel\_inference\_algorithm<Network\_>::bn}};}
\DoxyCodeLine{40         \textcolor{keyword}{public}:}
\DoxyCodeLine{41             \textcolor{keyword}{explicit} \mbox{\hyperlink{classbn_1_1inference_1_1rejection__sampling}{rejection\_sampling}}(}
\DoxyCodeLine{42                     \textcolor{keyword}{const} network\_type \& \mbox{\hyperlink{namespacebn}{bn}},}
\DoxyCodeLine{43                     ulong nsamples,}
\DoxyCodeLine{44                     uint nthreads = 1,}
\DoxyCodeLine{45                     uint seed = 0}
\DoxyCodeLine{46             )}
\DoxyCodeLine{47             : \mbox{\hyperlink{classbn_1_1inference_1_1parallel__inference__algorithm}{parallel\_inference\_algorithm<Network\_>}}(\mbox{\hyperlink{namespacebn}{bn}}, nsamples, nthreads, seed)}
\DoxyCodeLine{48             \{ \};}
\DoxyCodeLine{49 }
\DoxyCodeLine{50 }
\DoxyCodeLine{51         \textcolor{keyword}{private}:}
\DoxyCodeLine{52             \mbox{\hyperlink{classbn_1_1marginal__distribution}{bn::marginal\_distribution<probability\_type>}} sample\_step (}
\DoxyCodeLine{53                 ulong nsamples,}
\DoxyCodeLine{54                 uint seed}
\DoxyCodeLine{55             )\textcolor{keyword}{ override}}
\DoxyCodeLine{56 \textcolor{keyword}{            }\{}
\DoxyCodeLine{57                 std::vector<bn::state\_t> var\_state\_values;}
\DoxyCodeLine{58                 Generator\_ rnd\_gen(seed);}
\DoxyCodeLine{59 }
\DoxyCodeLine{60                 \mbox{\hyperlink{classbn_1_1marginal__distribution}{marginal\_distribution<probability\_type>}} marginal\_distr(\mbox{\hyperlink{namespacebn}{bn}}.begin(), \mbox{\hyperlink{namespacebn}{bn}}.end());}
\DoxyCodeLine{61                 ulong nvars =  \mbox{\hyperlink{namespacebn}{bn}}.number\_of\_variables();}
\DoxyCodeLine{62 }
\DoxyCodeLine{63                 var\_state\_values = std::vector<bn::state\_t>(nvars, 0);}
\DoxyCodeLine{64                 std::vector<bn::state\_t> samples;}
\DoxyCodeLine{65                 \textcolor{keywordflow}{for}(ulong i = 0; i < nsamples; ++i) \{}
\DoxyCodeLine{66                     \textcolor{keywordtype}{bool} reject = \textcolor{keyword}{false};}
\DoxyCodeLine{67                     \textcolor{keywordflow}{for} (ulong n = 0; n < nvars; ++n) \{}
\DoxyCodeLine{68                         bn::state\_t state\_val = prior\_sample(n, \mbox{\hyperlink{namespacebn}{bn}}, var\_state\_values, rnd\_gen);}
\DoxyCodeLine{69                         \textcolor{comment}{// if evidences are not sampled accordingly, discard the samples}}
\DoxyCodeLine{70                         \textcolor{keywordflow}{if}(\mbox{\hyperlink{namespacebn}{bn}}[n].is\_evidence() \&\& \mbox{\hyperlink{namespacebn}{bn}}[n].evidence\_state() != state\_val)}
\DoxyCodeLine{71                         \{}
\DoxyCodeLine{72                             reject = \textcolor{keyword}{true};}
\DoxyCodeLine{73                             \textcolor{keywordflow}{break};}
\DoxyCodeLine{74                         \}}
\DoxyCodeLine{75 }
\DoxyCodeLine{76                         var\_state\_values[n] = state\_val;}
\DoxyCodeLine{77                         samples.push\_back(state\_val);}
\DoxyCodeLine{78                     \}}
\DoxyCodeLine{79 }
\DoxyCodeLine{80                     \textcolor{keywordflow}{if}(!reject) \{}
\DoxyCodeLine{81                         ulong vid = 0;}
\DoxyCodeLine{82                         \textcolor{keywordflow}{for}(ulong s : samples)}
\DoxyCodeLine{83                             ++marginal\_distr[vid++][s];}
\DoxyCodeLine{84                     \}}
\DoxyCodeLine{85 }
\DoxyCodeLine{86                     samples.clear();}
\DoxyCodeLine{87                 \}}
\DoxyCodeLine{88 }
\DoxyCodeLine{89                 \textcolor{keywordflow}{return} marginal\_distr;}
\DoxyCodeLine{90             \}}
\DoxyCodeLine{91 }
\DoxyCodeLine{92             bn::state\_t prior\_sample(}
\DoxyCodeLine{93                     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} n,}
\DoxyCodeLine{94                     \textcolor{keyword}{const} std::vector<bn::state\_t> \&var\_state\_values,}
\DoxyCodeLine{95                     Generator\_ \&gen}
\DoxyCodeLine{96             )}
\DoxyCodeLine{97             \{}
\DoxyCodeLine{98                 \mbox{\hyperlink{classbn_1_1condition}{bn::condition}} c;}
\DoxyCodeLine{99                 \textcolor{comment}{// builds a condition using parents and}}
\DoxyCodeLine{100                 \textcolor{comment}{// their states}}
\DoxyCodeLine{101                 \textcolor{keywordflow}{for}(\textcolor{keyword}{auto} \& p : \mbox{\hyperlink{namespacebn}{bn}}.parents\_of(n))}
\DoxyCodeLine{102                     c.\mbox{\hyperlink{classbn_1_1condition_ace731b0369dc443b364192007dbbab68}{add}}(}
\DoxyCodeLine{103                         p,}
\DoxyCodeLine{104                         var\_state\_values[p]}
\DoxyCodeLine{105                     );}
\DoxyCodeLine{106 }
\DoxyCodeLine{107                 \textcolor{keyword}{const} \textcolor{keyword}{auto}\& cpt = \mbox{\hyperlink{namespacebn}{bn}}[n].table();}
\DoxyCodeLine{108                 \textcolor{comment}{// build discrete distribution from the parent states}}
\DoxyCodeLine{109                 std::discrete\_distribution<bn::state\_t> distr(cpt[c].begin(), cpt[c].end());}
\DoxyCodeLine{110                 \textcolor{keywordflow}{return} distr(gen);}
\DoxyCodeLine{111             \}}
\DoxyCodeLine{112         \};}
\DoxyCodeLine{113     \} \textcolor{comment}{// namespace inference}}
\DoxyCodeLine{114 \} \textcolor{comment}{//namespace bn}}
\DoxyCodeLine{115 }
\DoxyCodeLine{116 \textcolor{preprocessor}{\#endif }\textcolor{comment}{//BAYLIB\_REJECTION\_SAMPLING\_HPP}}

\end{DoxyCode}
