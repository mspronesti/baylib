\hypertarget{bayesian__network_8hpp_source}{}\doxysection{bayesian\+\_\+network.\+hpp}
\label{bayesian__network_8hpp_source}\index{/home/mspronesti/Desktop/baylib/baylib/network/bayesian\_network.hpp@{/home/mspronesti/Desktop/baylib/baylib/network/bayesian\_network.hpp}}
\mbox{\hyperlink{bayesian__network_8hpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{preprocessor}{\#ifndef BAYLIB\_BAYESIAN\_NETWORK\_HPP}}
\DoxyCodeLine{2 \textcolor{preprocessor}{\#define BAYLIB\_BAYESIAN\_NETWORK\_HPP}}
\DoxyCodeLine{3 }
\DoxyCodeLine{4 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{graph_8hpp}{baylib/graph/graph.hpp}}>}}
\DoxyCodeLine{5 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{random__variable_8hpp}{baylib/network/random\_variable.hpp}}>}}
\DoxyCodeLine{6 \textcolor{preprocessor}{\#include <baylib/baylib\_assert.h>}}
\DoxyCodeLine{7 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{bayesian__utils_8hpp}{baylib/network/bayesian\_utils.hpp}}>}}
\DoxyCodeLine{8 \textcolor{preprocessor}{\#include <baylib/baylib\_concepts.hpp>}}
\DoxyCodeLine{9 }
\DoxyCodeLine{12 }
\DoxyCodeLine{13 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespacebn}{bn}} \{}
\DoxyCodeLine{20     \textcolor{keyword}{template} <RVarDerived Variable\_>}
\DoxyCodeLine{21     \textcolor{keyword}{class }\mbox{\hyperlink{classbn_1_1bayesian__network}{bayesian\_network}} \{}
\DoxyCodeLine{22         \textcolor{keyword}{typedef} bn::graph<Variable\_> graph\_type;}
\DoxyCodeLine{23         \textcolor{keyword}{typedef} bn::vertex<Variable\_> vertex\_id;}
\DoxyCodeLine{24     \textcolor{keyword}{public}:}
\DoxyCodeLine{25         \textcolor{keyword}{typedef} Variable\_ variable\_type;}
\DoxyCodeLine{26         \textcolor{keyword}{typedef} \textcolor{keyword}{typename} variable\_type::probability\_type probability\_type;}
\DoxyCodeLine{27 }
\DoxyCodeLine{28         \mbox{\hyperlink{classbn_1_1bayesian__network}{bayesian\_network}}() : graph(std::make\_shared<graph\_type>()) \{ \}}
\DoxyCodeLine{29 }
\DoxyCodeLine{30         \textcolor{comment}{// overloading begin and end to easily loop over random\_variables}}
\DoxyCodeLine{31         \textcolor{comment}{// avoiding packing copies inside other facilities}}
\DoxyCodeLine{32         \textcolor{keyword}{auto} begin()\{}
\DoxyCodeLine{33             \textcolor{keywordflow}{return} \mbox{\hyperlink{namespacebn_aabfeec14957a6a84112596fc4aa18a9f}{bn::bundles}}(*graph).begin();}
\DoxyCodeLine{34         \}}
\DoxyCodeLine{35 }
\DoxyCodeLine{36         \textcolor{keyword}{auto} begin()\textcolor{keyword}{ const }\{}
\DoxyCodeLine{37             \textcolor{keywordflow}{return} \mbox{\hyperlink{namespacebn_aabfeec14957a6a84112596fc4aa18a9f}{bn::bundles}}(*graph).begin();}
\DoxyCodeLine{38         \}}
\DoxyCodeLine{39 }
\DoxyCodeLine{40         \textcolor{keyword}{auto} end() \{}
\DoxyCodeLine{41             \textcolor{keywordflow}{return} \mbox{\hyperlink{namespacebn_aabfeec14957a6a84112596fc4aa18a9f}{bn::bundles}}(*graph).end();}
\DoxyCodeLine{42         \}}
\DoxyCodeLine{43 }
\DoxyCodeLine{44         \textcolor{keyword}{auto} end()\textcolor{keyword}{ const }\{}
\DoxyCodeLine{45             \textcolor{keywordflow}{return} \mbox{\hyperlink{namespacebn_aabfeec14957a6a84112596fc4aa18a9f}{bn::bundles}}(*graph).end();}
\DoxyCodeLine{46         \}}
\DoxyCodeLine{47 }
\DoxyCodeLine{55         \textcolor{keyword}{template} <\textcolor{keyword}{typename} ...A>}
\DoxyCodeLine{56         vertex\_id \mbox{\hyperlink{classbn_1_1bayesian__network_a456a1829c6efb4f6c0c71d4a0ae48fae}{add\_variable}}(\textcolor{keyword}{const} A \&...args)\{}
\DoxyCodeLine{57             vertex\_id v = boost::add\_vertex(Variable\_\{args...\}, *graph);}
\DoxyCodeLine{58             (*graph)[v].\_id = v;}
\DoxyCodeLine{59             \textcolor{keywordflow}{return} v;}
\DoxyCodeLine{60         \}}
\DoxyCodeLine{61 }
\DoxyCodeLine{66         \textcolor{keywordtype}{void} \mbox{\hyperlink{classbn_1_1bayesian__network_a1843c2bfb82e98c2d29188fa471c0a64}{remove\_variable}}(vertex\_id var\_id) \{}
\DoxyCodeLine{67             boost::remove\_vertex(var\_id, *graph);}
\DoxyCodeLine{68         \}}
\DoxyCodeLine{69 }
\DoxyCodeLine{70 }
\DoxyCodeLine{76         \textcolor{keywordtype}{void} \mbox{\hyperlink{classbn_1_1bayesian__network_ac7c6a8a5af12f9a25179ef089987bc6e}{add\_dependency}}(vertex\_id src\_id, vertex\_id dest\_id) \{}
\DoxyCodeLine{77             BAYLIB\_ASSERT(\mbox{\hyperlink{classbn_1_1bayesian__network_a14f328f130273aaeb80630845e7857cd}{has\_variable}}(src\_id) \&\& \mbox{\hyperlink{classbn_1_1bayesian__network_a14f328f130273aaeb80630845e7857cd}{has\_variable}}(dest\_id),}
\DoxyCodeLine{78                           \textcolor{stringliteral}{"{}out of bound access to vertices"{}},}
\DoxyCodeLine{79                           std::out\_of\_range);}
\DoxyCodeLine{80 }
\DoxyCodeLine{81             BAYLIB\_ASSERT(!\mbox{\hyperlink{classbn_1_1bayesian__network_ab8aeb539424d8921d54fa0e5a9d8a11c}{introduces\_loop}}(dest\_id, src\_id),}
\DoxyCodeLine{82                           \textcolor{stringliteral}{"{}adding conditional dependency "{}}}
\DoxyCodeLine{83                           \textcolor{stringliteral}{"{} would introduce a loop"{}},}
\DoxyCodeLine{84                           std::logic\_error )}
\DoxyCodeLine{85 }
\DoxyCodeLine{86             boost::add\_edge(src\_id, dest\_id, *graph);}
\DoxyCodeLine{87         \}}
\DoxyCodeLine{88 }
\DoxyCodeLine{89 }
\DoxyCodeLine{95         \textcolor{keywordtype}{void} \mbox{\hyperlink{classbn_1_1bayesian__network_aba78719e461ad39429e2a64a91c22309}{remove\_dependency}}(vertex\_id src\_id, vertex\_id dest\_id) \{}
\DoxyCodeLine{96             BAYLIB\_ASSERT(\mbox{\hyperlink{classbn_1_1bayesian__network_a14f328f130273aaeb80630845e7857cd}{has\_variable}}(src\_id) \&\& \mbox{\hyperlink{classbn_1_1bayesian__network_a14f328f130273aaeb80630845e7857cd}{has\_variable}}(dest\_id),}
\DoxyCodeLine{97                           \textcolor{stringliteral}{"{}out of bound access to graph"{}},}
\DoxyCodeLine{98                           std::out\_of\_range)}
\DoxyCodeLine{99 }
\DoxyCodeLine{100             boost::remove\_edge(src\_id, dest\_id, *graph);}
\DoxyCodeLine{101         \}}
\DoxyCodeLine{102 }
\DoxyCodeLine{107         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{classbn_1_1bayesian__network_ae4ec631d35f9c0cefed5b9d36b80cbbf}{number\_of\_variables}}()\textcolor{keyword}{ const }\{}
\DoxyCodeLine{108             \textcolor{keywordflow}{return} boost::num\_vertices(*graph);}
\DoxyCodeLine{109         \}}
\DoxyCodeLine{110 }
\DoxyCodeLine{111 }
\DoxyCodeLine{117         variable\_type \& \mbox{\hyperlink{classbn_1_1bayesian__network_a973bdfe5c84b0097c55f163a69fbb0cb}{operator [] }}(vertex\_id v) \{}
\DoxyCodeLine{118             BAYLIB\_ASSERT(\mbox{\hyperlink{classbn_1_1bayesian__network_a14f328f130273aaeb80630845e7857cd}{has\_variable}}(v),}
\DoxyCodeLine{119                           \textcolor{stringliteral}{"{}out of bound access to graph"{}},}
\DoxyCodeLine{120                           std::out\_of\_range)}
\DoxyCodeLine{121 }
\DoxyCodeLine{122             \textcolor{keywordflow}{return} (*graph)[v];}
\DoxyCodeLine{123         \}}
\DoxyCodeLine{124 }
\DoxyCodeLine{130         variable\_type \& \mbox{\hyperlink{classbn_1_1bayesian__network_a973bdfe5c84b0097c55f163a69fbb0cb}{operator [] }}(vertex\_id v)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{131             BAYLIB\_ASSERT(\mbox{\hyperlink{classbn_1_1bayesian__network_a14f328f130273aaeb80630845e7857cd}{has\_variable}}(v),}
\DoxyCodeLine{132                           \textcolor{stringliteral}{"{}out of bound access to graph"{}},}
\DoxyCodeLine{133                           std::out\_of\_range)}
\DoxyCodeLine{134 }
\DoxyCodeLine{135             \textcolor{keywordflow}{return} (*graph)[v];}
\DoxyCodeLine{136         \}}
\DoxyCodeLine{137 }
\DoxyCodeLine{143         variable\_type \& \mbox{\hyperlink{classbn_1_1bayesian__network_a365b6f85bc3d410404638e6970871da4}{variable}}(vertex\_id v) \{}
\DoxyCodeLine{144             BAYLIB\_ASSERT(\mbox{\hyperlink{classbn_1_1bayesian__network_a14f328f130273aaeb80630845e7857cd}{has\_variable}}(v),}
\DoxyCodeLine{145                           \textcolor{stringliteral}{"{}out of bound access to graph"{}},}
\DoxyCodeLine{146                           std::out\_of\_range)}
\DoxyCodeLine{147 }
\DoxyCodeLine{148             \textcolor{keywordflow}{return} (*graph)[v];}
\DoxyCodeLine{149         \}}
\DoxyCodeLine{150 }
\DoxyCodeLine{151 }
\DoxyCodeLine{158         \textcolor{keywordtype}{bool} \mbox{\hyperlink{classbn_1_1bayesian__network_adcdd2cc6999b2b67c5afa2bd184ca6b5}{has\_dependency}}(vertex\_id v1, vertex\_id v2)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{159             BAYLIB\_ASSERT(\mbox{\hyperlink{classbn_1_1bayesian__network_a14f328f130273aaeb80630845e7857cd}{has\_variable}}(v1) \&\& \mbox{\hyperlink{classbn_1_1bayesian__network_a14f328f130273aaeb80630845e7857cd}{has\_variable}}(v2),}
\DoxyCodeLine{160                           \textcolor{stringliteral}{"{}out of bound access to graph"{}},}
\DoxyCodeLine{161                           std::out\_of\_range)}
\DoxyCodeLine{162 }
\DoxyCodeLine{163             \textcolor{keywordflow}{return} boost::edge(v1, v2, *graph).second;}
\DoxyCodeLine{164         \}}
\DoxyCodeLine{165 }
\DoxyCodeLine{171         \textcolor{keywordtype}{bool} \mbox{\hyperlink{classbn_1_1bayesian__network_a4334d6dfc6d7b9470f128cc667ab66dd}{is\_root}}(vertex\_id v)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{172             BAYLIB\_ASSERT(\mbox{\hyperlink{classbn_1_1bayesian__network_a14f328f130273aaeb80630845e7857cd}{has\_variable}}(v),}
\DoxyCodeLine{173                           \textcolor{stringliteral}{"{}out of bound access to graph"{}},}
\DoxyCodeLine{174                           std::out\_of\_range)}
\DoxyCodeLine{175 }
\DoxyCodeLine{176             \textcolor{keywordflow}{return} boost::in\_degree(v, *graph) == 0}
\DoxyCodeLine{177                   \&\& boost::out\_degree(v, *graph) != 0;}
\DoxyCodeLine{178         \}}
\DoxyCodeLine{179 }
\DoxyCodeLine{185         std::vector<vertex\_id> \mbox{\hyperlink{classbn_1_1bayesian__network_a3ded2022b4937ce2e38569ab871fa852}{children\_of}}(vertex\_id v)\textcolor{keyword}{ const}\{}
\DoxyCodeLine{186             BAYLIB\_ASSERT(\mbox{\hyperlink{classbn_1_1bayesian__network_a14f328f130273aaeb80630845e7857cd}{has\_variable}}(v),}
\DoxyCodeLine{187                           \textcolor{stringliteral}{"{}out of bound access to graph"{}},}
\DoxyCodeLine{188                           std::out\_of\_range)}
\DoxyCodeLine{189 }
\DoxyCodeLine{190             \textcolor{keyword}{auto} it = boost::make\_iterator\_range(adjacent\_vertices(v, *graph));}
\DoxyCodeLine{191             \textcolor{keywordflow}{return} std::vector<vertex\_id>(it.begin(), it.end());}
\DoxyCodeLine{192         \}}
\DoxyCodeLine{193 }
\DoxyCodeLine{199         std::vector<vertex\_id> \mbox{\hyperlink{classbn_1_1bayesian__network_ab9dff7e80e1ad29b2e39aaa7f9a22d18}{parents\_of}}(vertex\_id v)\textcolor{keyword}{ const}\{}
\DoxyCodeLine{200             BAYLIB\_ASSERT(\mbox{\hyperlink{classbn_1_1bayesian__network_a14f328f130273aaeb80630845e7857cd}{has\_variable}}(v),}
\DoxyCodeLine{201                           \textcolor{stringliteral}{"{}out of bound access to graph"{}},}
\DoxyCodeLine{202                           std::out\_of\_range)}
\DoxyCodeLine{203 }
\DoxyCodeLine{204             std::vector<vertex\_id> parents;}
\DoxyCodeLine{205 }
\DoxyCodeLine{206             \textcolor{keywordflow}{for}(\textcolor{keyword}{auto} ed : boost::make\_iterator\_range(boost::in\_edges(v, *graph)))}
\DoxyCodeLine{207                 parents.push\_back(boost::source(ed, *graph));}
\DoxyCodeLine{208 }
\DoxyCodeLine{209             \textcolor{keywordflow}{return} parents;}
\DoxyCodeLine{210         \}}
\DoxyCodeLine{211 }
\DoxyCodeLine{219         \textcolor{keywordtype}{void} \mbox{\hyperlink{classbn_1_1bayesian__network_a0e2a442eb435f7a18e329ee3d1094602}{set\_variable\_probability}}(}
\DoxyCodeLine{220                 \textcolor{keyword}{const} vertex\_id var\_id,}
\DoxyCodeLine{221                 bn::state\_t state\_value,}
\DoxyCodeLine{222                 \textcolor{keyword}{const} \mbox{\hyperlink{classbn_1_1condition}{bn::condition}}\& cond,}
\DoxyCodeLine{223                 probability\_type p}
\DoxyCodeLine{224         )}
\DoxyCodeLine{225         \{}
\DoxyCodeLine{226             \textcolor{keyword}{auto} nparents = \mbox{\hyperlink{classbn_1_1bayesian__network_ab9dff7e80e1ad29b2e39aaa7f9a22d18}{parents\_of}}(var\_id).size();}
\DoxyCodeLine{227 }
\DoxyCodeLine{228             \textcolor{comment}{// make sure the cardinality of parents is correct}}
\DoxyCodeLine{229             BAYLIB\_ASSERT(cond.\mbox{\hyperlink{classbn_1_1condition_aed53588d848d44a4f8b9d4fbeb93f472}{size}}() == nparents,}
\DoxyCodeLine{230                           \textcolor{stringliteral}{"{}condition contains "{}}}
\DoxyCodeLine{231                           << cond.\mbox{\hyperlink{classbn_1_1condition_aed53588d848d44a4f8b9d4fbeb93f472}{size}}() << \textcolor{stringliteral}{"{} while "{}}}
\DoxyCodeLine{232                           \textcolor{stringliteral}{"{}variable "{}} << var\_id}
\DoxyCodeLine{233                           << \textcolor{stringliteral}{"{} has "{}} << nparents,}
\DoxyCodeLine{234                           std::logic\_error)}
\DoxyCodeLine{235 }
\DoxyCodeLine{236             \textcolor{comment}{// make sure the parents are actually correct}}
\DoxyCodeLine{237             BAYLIB\_ASSERT(std::all\_of(cond.\mbox{\hyperlink{classbn_1_1condition_adf8a1082874d74df924d46957fe30da0}{begin}}(), cond.\mbox{\hyperlink{classbn_1_1condition_a5a74ad63c485e07ba2485940cda2a627}{end}}(),}
\DoxyCodeLine{238                                       [\textcolor{keyword}{this}, var\_id](\textcolor{keyword}{const} \textcolor{keyword}{auto}\&c)\{}
\DoxyCodeLine{239                                           return has\_dependency(c.first, var\_id);}
\DoxyCodeLine{240                                       \}),}
\DoxyCodeLine{241                           \textcolor{stringliteral}{"{}no such parent for variable "{}}}
\DoxyCodeLine{242                           << var\_id,}
\DoxyCodeLine{243                           std::runtime\_error)}
\DoxyCodeLine{244 }
\DoxyCodeLine{245             (*graph)[var\_id].set\_probability(state\_value, cond, p);}
\DoxyCodeLine{246 }
\DoxyCodeLine{247             \textcolor{keywordflow}{if}(\mbox{\hyperlink{namespacebn_a8488fe928f91fd19041fd541611ed1cf}{cpt\_filled\_out}}(*\textcolor{keyword}{this}, var\_id))}
\DoxyCodeLine{248                 \mbox{\hyperlink{classbn_1_1bayesian__network_abc3b8a71707ea15ab1678bdacd06ba0d}{optimize\_cpt\_memory\_occupation}}(var\_id);}
\DoxyCodeLine{249         \}}
\DoxyCodeLine{250 }
\DoxyCodeLine{257         \textcolor{keywordtype}{bool} \mbox{\hyperlink{classbn_1_1bayesian__network_a14f328f130273aaeb80630845e7857cd}{has\_variable}}(vertex\_id v)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{258             \textcolor{keywordflow}{return} boost::num\_vertices(*graph) > v;}
\DoxyCodeLine{259         \}}
\DoxyCodeLine{260 }
\DoxyCodeLine{261 }
\DoxyCodeLine{262     \textcolor{keyword}{private}:}
\DoxyCodeLine{263         std::shared\_ptr<graph\_type> graph;}
\DoxyCodeLine{264         std::unordered\_map<size\_t, vertex\_id> cpt\_hash\_map;}
\DoxyCodeLine{265 }
\DoxyCodeLine{273         \textcolor{keywordtype}{bool} \mbox{\hyperlink{classbn_1_1bayesian__network_ab8aeb539424d8921d54fa0e5a9d8a11c}{introduces\_loop}}(vertex\_id from, vertex\_id to)\{}
\DoxyCodeLine{274             \textcolor{keywordflow}{if}(from == to) \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{275 }
\DoxyCodeLine{276             \textcolor{keyword}{auto} \textcolor{keyword}{const} children = \mbox{\hyperlink{classbn_1_1bayesian__network_a3ded2022b4937ce2e38569ab871fa852}{children\_of}}(from);}
\DoxyCodeLine{277             \textcolor{keywordflow}{return} std::any\_of(}
\DoxyCodeLine{278                     children.cbegin(), children.cend(),}
\DoxyCodeLine{279                     [\textcolor{keyword}{this}, \&to](vertex\_id next)\{}
\DoxyCodeLine{280                         return introduces\_loop(next, to);}
\DoxyCodeLine{281                     \});}
\DoxyCodeLine{282         \}}
\DoxyCodeLine{283 }
\DoxyCodeLine{284 }
\DoxyCodeLine{292         \textcolor{keywordtype}{void} \mbox{\hyperlink{classbn_1_1bayesian__network_abc3b8a71707ea15ab1678bdacd06ba0d}{optimize\_cpt\_memory\_occupation}}(vertex\_id \textcolor{keywordtype}{id})\{}
\DoxyCodeLine{293             \textcolor{keyword}{auto} seed = \mbox{\hyperlink{classbn_1_1bayesian__network_a365b6f85bc3d410404638e6970871da4}{variable}}(\textcolor{keywordtype}{id}).cpt.hash();}
\DoxyCodeLine{294             \textcolor{keywordflow}{if}(cpt\_hash\_map.find(seed) != cpt\_hash\_map.end())\{}
\DoxyCodeLine{295                 \textcolor{keyword}{auto} var = \mbox{\hyperlink{classbn_1_1bayesian__network_a365b6f85bc3d410404638e6970871da4}{variable}}(cpt\_hash\_map[seed]);}
\DoxyCodeLine{296                 \textcolor{keywordflow}{if}(var.\_id != \textcolor{keywordtype}{id} \&\& var.cpt == \mbox{\hyperlink{classbn_1_1bayesian__network_a365b6f85bc3d410404638e6970871da4}{variable}}(\textcolor{keywordtype}{id}).cpt)\{}
\DoxyCodeLine{297                     \mbox{\hyperlink{classbn_1_1bayesian__network_a365b6f85bc3d410404638e6970871da4}{variable}}(\textcolor{keywordtype}{id}).cpt.d = var.cpt.d;}
\DoxyCodeLine{298                     \textcolor{keywordflow}{return};}
\DoxyCodeLine{299                 \}}
\DoxyCodeLine{300             \}}
\DoxyCodeLine{301             cpt\_hash\_map[seed] = id;}
\DoxyCodeLine{302         \}}
\DoxyCodeLine{303     \};}
\DoxyCodeLine{304 \} \textcolor{comment}{// namespace bn}}
\DoxyCodeLine{305 }
\DoxyCodeLine{306 \textcolor{preprocessor}{\#endif }\textcolor{comment}{//BAYLIB\_BAYESIAN\_NETWORK\_HPP}}

\end{DoxyCode}
